<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Money Tracker</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-gray-100 text-gray-800 p-6">
  <div class="max-w-3xl mx-auto bg-white p-6 rounded-xl shadow-md">
    <h1 class="text-3xl font-bold text-center mb-4">üí∞ Money Tracker</h1>
    <div class="text-center text-xl font-semibold mb-6">Saldo: ‚Ç¨<span id="balance">0.00</span></div>

    <form id="form" class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-4">
      <input id="desc" required placeholder="Omschrijving" class="col-span-2 border rounded px-3 py-2" />
      <input id="amount" type="number" required placeholder="Bedrag" step="0.01" class="border rounded px-3 py-2" />
      <select id="type" class="border rounded px-3 py-2">
        <option value="income">Inkomen</option>
        <option value="expense">Uitgave</option>
      </select>
      <button type="submit" class="col-span-1 md:col-span-4 bg-blue-600 text-white py-2 rounded">Toevoegen</button>
    </form>

    <button id="resetBtn" class="w-full bg-red-600 text-white py-2 mb-6 rounded">Reset alles</button>

    <ul id="list" class="space-y-2 max-h-64 overflow-y-auto mb-6"></ul>

    <div class="flex justify-between items-center mb-2">
      <button id="prevBtn" class="bg-gray-300 px-4 py-1 rounded hover:bg-gray-400">‚Üê Vorige</button>
      <button id="nextBtn" class="bg-gray-300 px-4 py-1 rounded hover:bg-gray-400">Volgende ‚Üí</button>
    </div>
    <canvas id="chart" height="200"></canvas>
  </div>

  <script>
    const startDate = new Date("2024-12-01");
    const monthlyIncome = 10;
    let transactions = [];
    let idCounter = 0;
    let chart;
    let chartPage = 0;
    let maxMonths = window.innerWidth < 640 ? 3 : 6;

    const balanceEl = document.getElementById("balance");
    const list = document.getElementById("list");
    const form = document.getElementById("form");
    const resetBtn = document.getElementById("resetBtn");
    const prevBtn = document.getElementById("prevBtn");
    const nextBtn = document.getElementById("nextBtn");

    function load() {
      const data = JSON.parse(localStorage.getItem("transactions"));
      if (Array.isArray(data)) {
        transactions = data;
        const manual = transactions.filter(t => !t.id.startsWith("auto-"));
        idCounter = manual.length ? Math.max(...manual.map(t => +t.id)) : 0;
      }
    }

    function save() {
      localStorage.setItem("transactions", JSON.stringify(transactions));
    }

    function ensureMonthlyIncome() {
      // genereer auto-inkomen alleen op transaction load
      const now = new Date();
      let current = new Date(startDate);
      while (current <= now) {
        const key = `auto-${current.getFullYear()}-${String(current.getMonth()+1).padStart(2,'0')}`;
        if (!transactions.some(t => t.id === key)) {
          transactions.push({
            id: key,
            desc: `Maandinkomen ${key.slice(5)}`,
            amount: monthlyIncome,
            type: "income",
            date: current.toISOString()
          });
        }
        current.setMonth(current.getMonth()+1);
      }
    }

    function updateBalance() {
      const total = transactions.reduce((sum, t) =>
        sum + (t.type === "income" ? t.amount : -t.amount)
      , 0);
      balanceEl.textContent = total.toFixed(2);
    }

    function renderTransactions() {
      list.innerHTML = "";
      transactions.forEach(t => {
        const li = document.createElement("li");
        li.className = "flex justify-between items-center bg-gray-100 rounded px-4 py-2";
        li.innerHTML = `
          <span>${t.desc}</span>
          <span class="flex items-center gap-2">
            <span class="${t.type==='income'?'text-green-600':'text-red-600'}">
              ${t.type==='income'?'+':'-'}‚Ç¨${t.amount.toFixed(2)}
            </span>
            ${!t.id.startsWith("auto-")?`<button onclick="remove('${t.id}')" class="text-gray-500 hover:text-black">üóë</button>`:""}
          </span>`;
        list.appendChild(li);
      });
    }

    function remove(id) {
      transactions = transactions.filter(t => t.id !== id);
      save();
      render();
    }

    function getMonthData(index) {
      // index 0 = startDate, 1 = next month, -1 = month v√≥√≥r startDate, etc.
      const d = new Date(startDate.getFullYear(), startDate.getMonth() + index, 1);
      const key = `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}`;
      // bereken netto in transactions
      let net = 0;
      transactions.forEach(t => {
        const td = new Date(t.date);
        const tk = `${td.getFullYear()}-${String(td.getMonth()+1).padStart(2,'0')}`;
        if (tk === key) net += (t.type==="income"? t.amount : -t.amount);
      });
      return { month: key, value: +net.toFixed(2) };
    }

    function renderChart() {
      // genereer array van maxMonths elementen vanaf chartPage*maxMonths
      const startIndex = chartPage * maxMonths;
      const slice = [];
      for (let i = startIndex; i < startIndex + maxMonths; i++) {
        slice.push(getMonthData(i));
      }

      const labels = slice.map(d => d.month);
      const values = slice.map(d => d.value);
      const colors = values.map(v => v>0? "#22c55e" : v===0? "#f59e0b" : "#ef4444");

      if (chart) chart.destroy();
      chart = new Chart(document.getElementById("chart"), {
        type: "bar",
        data: {
          labels,
          datasets: [{ label:"Netto per maand", data: values, backgroundColor: colors }]
        },
        options: {
          responsive: true,
          scales: {
            y: { beginAtZero:true, ticks:{ callback: v=>`‚Ç¨${v}` } }
          }
        }
      });
    }

    form.addEventListener("submit", e => {
      e.preventDefault();
      const desc = document.getElementById("desc").value.trim();
      const amount = parseFloat(document.getElementById("amount").value);
      const type = document.getElementById("type").value;
      if (!desc||isNaN(amount)) return;
      const date = new Date().toISOString();
      transactions.push({ id: (++idCounter).toString(), desc, amount, type, date });
      save();
      render();
      form.reset();
    });

    resetBtn.addEventListener("click", () => {
      if (confirm("Alles resetten?")) {
        transactions = [];
        idCounter = 0;
        chartPage = 0;
        localStorage.removeItem("transactions");
        init();
      }
    });

    prevBtn.addEventListener("click", () => { chartPage--; renderChart(); });
    nextBtn.addEventListener("click", () => { chartPage++; renderChart(); });

    function render() {
      ensureMonthlyIncome();
      save();
      updateBalance();
      renderTransactions();
      renderChart();
    }

    function init() {
      load();
      render();
    }

    init();
  </script>
</body>
</html>
